syntax = "proto3";

package cloud.api.miners.v1;

import "google/protobuf/empty.proto";
import "google/api/annotations.proto";
import "github.com/gogo/protobuf/gogoproto/gogo.proto";

import "miners/v1/miner.proto";

option go_package = "v1";
option (gogoproto.marshaler_all) = false;
option (gogoproto.unmarshaler_all) = false;
option (gogoproto.sizer_all) = false;
option (gogoproto.goproto_registration) = true;
option (gogoproto.messagename_all) = true;

service MinersService {
    rpc Create(google.protobuf.Empty) returns (MinerResponse) {
        option (google.api.http) = {
            post: "/api/v1/miners",
            body: "*"
        };
    }

    rpc Get(MinerRequest) returns (MinerResponse) {
        option (google.api.http) = {
            get: "/api/v1/miners/{id}"
        };
    }

    rpc Register(RegistrationRequest) returns (MinerResponse) {}

    rpc GetByID(MinerRequest) returns (MinerResponse) {}

    rpc List(MinerRequest) returns (MinerListResponse) {
        option (google.api.http) = {
            get: "/api/v1/miners"
        };
    }

    rpc Ping(PingRequest) returns (PingResponse) {}

    rpc AssignTask(AssignTaskRequest) returns (google.protobuf.Empty) {}

    rpc UnassignTask(AssignTaskRequest) returns (google.protobuf.Empty) {}

    rpc SetTags(SetTagsRequest) returns (MinerResponse) {
        option (google.api.http) = {
            put: "/api/v1/miners/{id}/tags"
            body: "*"
        };
    }

    rpc GetForceTaskList(google.protobuf.Empty) returns (ForceTaskListResponse) {}
}

message RegistrationRequest {
    string client_id = 1 [(gogoproto.customname) = "ClientID"];
    string address = 2;
  }

message MinerRequest {
    string id = 1;
}

message MinerResponse {
    string id = 1;
    MinerStatus status = 2;
    map<string, string> tags = 3;
}

message MinerListResponse {
    repeated MinerResponse items = 1;
}

message PingRequest {
    string client_id = 1 [(gogoproto.customname) = "ClientID"];
    bytes system_info = 2;
}
  
message PingResponse {}

message AssignTaskRequest {
    string client_id = 1 [(gogoproto.customname) = "ClientID"];
    string task_id = 2 [(gogoproto.customname) = "TaskID"];
}

message Tag {
    string key = 1;
    string value = 2;
}

message SetTagsRequest {
    string id = 1;
    repeated Tag tags = 2;
}

message ForceTaskListResponse {
    repeated string ids = 1;
}
